webpackJsonp([24],{G2DF:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("Gu7T"),s=i.n(n),a={components:{},props:{desc:{type:Boolean,default:!1},fileInfo:{type:Array,default:function(){return[]}},downLoad:{type:Boolean,default:!0},multiple:{type:Boolean,default:!1},maxFile:{type:Number,default:5},maxSize:{type:Number,default:3},autoUpload:{type:Boolean,default:!0},img:{type:Boolean,default:!1},excel:{type:Boolean,default:!1},fileTypes:{type:Array,default:function(){return[]}},url:{type:String,default:""},uploadBefore:{type:Function,default:function(e){return!0}},uploadAfter:{type:Function,default:function(e,t){return!0}},onChange:{type:Function,default:function(e){return!0}},fileList:{type:Boolean,default:!0},fileClick:{type:Function,default:function(e,t,i){return!0}},removeBefore:{type:Function,default:function(e,t,i){return!0}},append:{type:Boolean,default:!1}},data:function(){return{errorImg:'this.src="'+i("ScXB")+'"',changed:!1,model:!0,files:[],bigImg:"",loadingStatus:!1,loadText:"上传文件"}},created:function(){this.fileInfo&&(this.changed=!0)},methods:{previewImg:function(e){this.base.previewImg(this.getImgSrc((this.files.length>0?this.files:this.fileInfo)[e]))},getSelector:function(){return this.autoUpload?"auto-selector":"submit-selector"},getImgSrc:function(e){return e.hasOwnProperty("path")?this.base.isUrl(e.path)?e.path:("/"==e.path.substr(0,1)&&(e.path=e.path.substr(1)),this.http.ipAddress+e.path):window.URL.createObjectURL(e)},fileOnClick:function(e,t){this.fileClick(e,t,this.files)&&this.downLoad&&(t.path?this.base.dowloadFile(t.path,t.name,{Authorization:this.$store.getters.getToken()},this.http.ipAddress):this.$Message.error("请先上传文件"))},getText:function(){return this.img?"只能上传图片,":this.excel?"只能上传excel文件,":void 0},handleClick:function(){this.$refs.input.click()},handleChange:function(e){var t;this.clearFiles();var i=this.checkFile(e.target.files);i&&(this.changed=!1,this.onChange(e.target.files)&&((t=this.files).push.apply(t,s()(e.target.files)),this.$refs.input.value=null,this.autoUpload&&i&&this.upload()))},removeFile:function(e){var t=this.fileInfo.length>0?this.fileInfo[e]:this.files[e];this.fileInfo.length?this.fileInfo.splice(e,1):this.files.splice(e,1),this.removeBefore(e,t,this.fileInfo)},clearFiles:function(){this.files.splice(0)},getFiles:function(){return this.files},upload:function(){var e=this;if(!this.checkFile())return!1;if(!this.url)return this.$Message.error({duration:5,content:"没有配置好Url"});if(!this.files||0==this.files.length)return this.$Message.error({duration:5,content:"请选择文件"});if(this.uploadBefore(this.files)){var t=new FormData;this.files.forEach(function(e){t.append("fileInput",e,e.name)}),this.loadingStatus=!0,this.loadText="上传中..",this.http.post(this.url,t,this.autoUpload?"正在上传文件":"").then(function(t){e.loadingStatus=!1,e.loadText="上传文件",e.uploadAfter(t,e.files)?(e.changed=!0,e.$Message.success({duration:5,content:t.message}),e.changed=t.status,t.status&&(e.append||e.fileInfo.splice(0),e.files.forEach(function(i){e.fileInfo.push({name:i.name,path:t.data+i.name})}),e.clearFiles())):e.changed=!1},function(t){e.loadText="上传文件",e.loadingStatus=!1})}},format:function(e,t){var i=e.name.split(".").pop().toLocaleLowerCase()||"",n="ios-document-outline";if(this.fileTypes.length>0&&void 0!=t)return-1!=this.fileTypes.indexOf(i);if(t&&!(t instanceof Array)&&"img"!=t&&"excel"!=t)return t.indexOf(i)>-1;if("img"==t||["gif","jpg","jpeg","png","bmp","webp"].indexOf(i)>-1){if("img"==t)return["gif","jpg","jpeg","png","bmp","webp"].indexOf(i)>-1;n="ios-image"}if(["mp4","m3u8","rmvb","avi","swf","3gp","mkv","flv"].indexOf(i)>-1&&(n="ios-film"),["mp3","wav","wma","ogg","aac","flac"].indexOf(i)>-1&&(n="ios-musical-notes"),["doc","txt","docx","pages","epub","pdf"].indexOf(i)>-1&&(n="md-document"),"excel"==t||["numbers","csv","xls","xlsx"].indexOf(i)>-1){if("excel"==t)return["numbers","csv","xls","xlsx"].indexOf(i)>-1;n="ios-podium"}return["keynote","ppt","pptx"].indexOf(i)>-1&&(n="ios-videocam"),n},beforeUpload:function(){},checkFile:function(e){if(e||(e=this.files),this.multiple&&e.length+this.fileInfo.length>(this.maxFile||5))return this.$Message.error({duration:5,content:"最多只能选【"+(this.maxFile||5)+"】"+(this.img?"张图片":"个文件")}),!1;for(var t=[],i=0;i<e.length;i++){var n=e[i];if(-1!=t.indexOf(n.name)&&(n.name="("+i+")"+n.name),t.push(n.name),this.img&&!this.format(n,"img"))return this.$Message.error({duration:5,content:"选择的文件【"+n.name+"】只能是图片格式"}),!1;if(this.excel&&!this.format(n,"excel"))return this.$Message.error({duration:5,content:"选择的文件【"+n.name+"】只能是excel文件"}),!1;if(this.fileTypes&&this.fileTypes.length>0&&!this.format(n,this.fileTypes))return this.$Message.error({duration:5,content:"选择的文件【"+n.name+"】只能是【"+this.fileTypes.join(",")+"】格式"}),!1;if(n.size>1024*(this.maxSize||3)*1024)return this.$Message.error({duration:5,content:"选择的文件【"+n.name+"】不能超过:"+(this.maxSize||3)+"M"}),!1}return!0}}},l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"upload-container"},[i("div",[i("div",{staticClass:"input-btns",staticStyle:{"margin-bottom":"10px"}},[i("input",{ref:"input",staticStyle:{display:"none"},attrs:{type:"file",multiple:e.multiple},on:{change:e.handleChange}}),e._v(" "),e.img?i("div",{staticClass:"upload-img"},[e._l(e.files.length>0?e.files:e.fileInfo,function(t,n){return i("div",{key:n,staticClass:"img-item"},[i("div",{staticClass:"operation"},[i("div",{staticClass:"action"},[i("Icon",{staticClass:"view",attrs:{type:"md-eye"},on:{click:function(t){e.previewImg(n)}}}),e._v(" "),i("Icon",{staticClass:"remove",attrs:{type:"md-close"},on:{click:function(t){e.removeFile(n)}}})],1),e._v(" "),i("div",{staticClass:"mask"})]),e._v(" "),i("img",{attrs:{src:e.getImgSrc(t),onerror:e.errorImg}})])}),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.autoUpload||e.autoUpload&&e.files.length<e.maxFile&&e.fileInfo.length<e.maxFile,expression:"!autoUpload||(autoUpload&&files.length<maxFile&&fileInfo.length<maxFile)"}],staticClass:"img-selector",class:e.getSelector()},[i("div",{staticClass:"selector",on:{click:e.handleClick}},[i("Icon",{attrs:{type:"ios-camera"}})],1),e._v(" "),e.autoUpload?e._e():i("div",{staticClass:"s-btn",class:{readonly:e.changed},on:{click:e.upload}},[i("div",[e._v(e._s(e.loadText))])])])],2):i("Button",{attrs:{icon:"ios-cloud-upload-outline"},on:{click:e.handleClick}},[e._v("选择"+e._s(e.img?"图片":"文件"))]),e._v(" "),e.autoUpload||e.img?e._e():i("Button",{attrs:{type:"info",disabled:e.changed,icon:"md-arrow-round-up",loading:e.loadingStatus},on:{click:e.upload}},[e._v("上传文件")])],1),e._v(" "),e._t("default"),e._v(" "),e.desc?i("div",[i("Alert",{attrs:{"show-icon":""}},[e._v(e._s(e.getText())+"文件大小不超过"+e._s(e.maxSize||3)+"M")])],1):e._e(),e._v(" "),e._t("content"),e._v(" "),e.img?e._e():i("div",[i("ul",{directives:[{name:"show",rawName:"v-show",value:e.fileList,expression:"fileList"}],staticClass:"upload-list"},e._l(e.files.length>0?e.files:e.fileInfo,function(t,n){return i("li",{key:n,staticClass:"list-file"},[i("a",[i("span",{on:{click:function(i){e.fileOnClick(n,t)}}},[i("Icon",{attrs:{type:e.format(t)}}),e._v("\n              "+e._s(t.name)+"\n            ")],1)]),e._v(" "),i("span",{staticClass:"file-remove",on:{click:function(t){e.removeFile(n)}}},[i("Icon",{attrs:{type:"md-close"}})],1)])}),0)]),e._v(" "),e._t("tip")],2)])},staticRenderFns:[]};var o=i("VU/8")(a,l,!1,function(e){i("mkw0")},"data-v-5f3f73db",null);t.default=o.exports},mkw0:function(e,t){}});